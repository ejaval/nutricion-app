<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Crear Nuevo Usuario</title>
  <link rel="stylesheet" href="/css/sidebar.css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/auth-check.js"></script>
</head>
<body>
  <button class="menu-toggle" id="menuToggle">☰</button>

  <div class="sidebar" id="sidebar">
    <h2>Menú Nutricionista</h2>
    <a href="crear-usuario.html">Crear Nuevo Usuario</a>
    <a href="#" id="abrirChatGrupalBtn">Chat Grupal</a>
    <a href="#" id="logoutBtn">Salir</a>
  </div>

  <div class="container">
    <h2>Crear Nuevo Usuario</h2>

    <form id="formUsuario">
      <input type="text" id="nombreUsuario" placeholder="Nombre Completo" required>
      <input type="password" id="password" placeholder="Contraseña" required>
      <select id="role" required>
        <option value="">Selecciona rol</option>
        <option value="paciente">Paciente</option>
        <option value="nutricionista">Nutricionista</option>
      </select>
      <button type="submit" id="btnCrearUsuario" href="href="dashboard-nutricionista.html">Crear Usuario</button>
    </form>
  </div>

      // Crear usuario
      formUsuario.addEventListener("submit", async (e) => {
        e.preventDefault();

        const nombre = document.getElementById("nombreUsuario").value.trim();
        const password = document.getElementById("password").value;
        const role = document.getElementById("role").value;

        const token = localStorage.getItem("token");
        if(!token){
          alert("Token no disponible. Debes hacer login primero.");
          return;
        }

        try {
          const res = await fetch("/create-user", {
            method: "POST",
            headers: { 
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`
            },
            body: JSON.stringify({ nombre, password, role })
          });

          const data = await res.json();

          if(res.ok){
            alert("Usuario creado correctamente!");
            formUsuario.reset();
            cargarUsuarios(); // Recargar lista
          } else {
            alert("Error: " + (data.error || "No se pudo crear el usuario"));
          }

        } catch (err) {
          console.error(err);
          alert("Error al conectarse con el servidor");
        }
      });

      // Llamar al inicio
      cargarUsuarios();
    });
  </script>
</body>
</html>
